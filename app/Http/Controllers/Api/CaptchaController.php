<?php

namespace App\Http\Controllers\Api;

use App\Helpers\ApiResponseHelper;
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Http;
use Mews\Captcha\Captcha;
use Mews\Captcha\Facades\Captcha as FacadesCaptcha;

class CaptchaController extends Controller
{
    public function view()
    {
        // Generate captcha key
         $captchaKey = FacadesCaptcha::create('math', true);

        // // Get captcha image URL
        // $captchaImageURL = FacadesCaptcha::src('math');

        $base64Image = $captchaKey['img']; // Encode the image as PNG
        $base64Image = str_replace('data:image/png;base64,', '', $base64Image);
        $imageData = base64_decode($base64Image);
        $filePath = public_path('images/captcha/captchaImg.png'); // Define the file path where you want to save the image

        file_put_contents($filePath, $imageData); // Save the image data to the file

        $imageUrl = asset('images/captcha/captchaImg.png'); // Get the URL of the saved image


        // Now, you can use $captchaKey and $captchaImageURL as needed
        $response = [
            'key' => $captchaKey['key'],
            'img' => $imageUrl,
        ];
        return response()->json($response);

        // $base64Image = "data:image/png;base64,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";

        // // Remove the data:image/png;base64, part from the base64 string
        // $base64Image = str_replace('data:image/png;base64,', '', $base64Image);

        // // Decode the base64 image data
        // $imageData = base64_decode($base64Image);

        // // Create a response with the image data
        // return response($imageData)
        //     ->header('Content-Type', 'image/png');

        return ApiResponseHelper::apiResponse('Success', '200', 'captcha image sent', captcha_src('math'));
    }
}
